{"version":3,"sources":["webpack:///src/views/butler/page/src/views/butler/page/businessManagement.vue"],"names":[],"mappings":"AA4ZA,WACA,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,eAAA,CACA,0BAAA,CACA,iBAAA,CACA,qBAAA,CACA,gCAAA,CACA,iBACA","file":"chunk-89e22638.941e57ca.css","sourcesContent":["\n<template>\n  <div class=\"main-content\">\n    <div class=\"main-titel\">\n      <span>业委会管理</span>\n    </div>\n    <div class=\"content\">\n      <div class=\"content-btn\">\n        <el-button class=\"init-button\"\n                   icon=\"el-icon-plus\"\n                   @click=\"addOwnersCommittee\">新增成员</el-button>\n      </div>\n      <!-- 查询重制 -->\n      <div class=\"\">\n        <VueTable ref=\"table\"\n                  :config='config'\n                  @tableCheck=\"tableCheck\">\n          <template slot=\"footer\">\n            <div class=\"table-footer\">\n              <button @click='edit(table_row)'>编辑</button>\n              <button @click=\"del(table_row)\">删除</button>\n\n            </div>\n          </template>\n        </VueTable>\n      </div>\n    </div>\n    <!--业委会增加修改 -->\n    <Drawer :drawerTitle=\"ownersCommitteeTitle\"\n            @drawerClose=\"ownersCommitteeClose\"\n            :drawerVrisible='ownersCommittee_vrisible'>\n      <div style=\"padding:30px\">\n        <FromCard>\n          <template slot=\"title\">基本信息</template>\n          <template>\n            <VueForm ref=\"ownersCommitteeVueForm\"\n                     @ruleSuccess='ownersCommitteeRuleSubmit'\n                     :formObj='ownersCommitteeForm'>\n              <template slot='fileUrls'>\n                <template>\n                  <el-upload :action=\"`${$baseUrl}upload/uploadOwnersCommittee`\"\n                             :on-success=\"ownersImgeSuccess\"\n                             :show-file-list=\"false\"\n                             :before-upload=\"beforeAvatarUpload\">\n                    <div class='sys-image'\n                         style='width:104px; height:104px'>\n                      <div v-if=\"!fileUrls\">\n                        <i class=\"el-icon-plus\"></i>\n                        <p>上传照片</p>\n                      </div>\n                      <template v-else>\n                        <!-- 临时地址 新增状态 -->\n                        <el-image v-if=\"!editBool\"\n                                  :src=\"`${$ImgUrl}/temp${fileUrls}`\"\n                                  style=\"width: 104px; height: 104px\"></el-image>\n                        <!-- 非临时地址  编辑状态-->\n                        <el-image v-else\n                                  :src=\"`${$ImgUrl}${fileUrls}`\"\n                                  style=\"width: 104px; height: 104px\"></el-image>\n                      </template>\n                    </div>\n                  </el-upload>\n                </template>\n              </template>\n              <!-- editId?'true':'false' -->\n              <template v-slot:residentId>\n                <el-select v-model=\"ownersCommitteeForm.ruleForm.residentId\"\n                           :disabled=\"editId?true:false\"\n                           :remote-method='remoteMethod'\n                           @change='(value) => change(value,options)'\n                           @focus='focus'\n                           :loading=\"loading\"\n                           remote\n                           style=\"width:240px\"\n                           filterable\n                           placeholder=\"请选择\">\n                  <el-option v-for=\"(item,index) in options\"\n                             :key=\"index\"\n                             :label=\"item.label\"\n                             :value=\"item.value\">\n                  </el-option>\n                </el-select>\n              </template>\n\n            </VueForm>\n          </template>\n        </FromCard>\n      </div>\n      <div slot=\"footer\">\n        <button class=\"btn-orange\"\n                @click=\"ownersCommitteeSubmit()\"><span> <i class=\"el-icon-circle-check\"></i>提交</span></button>\n        <button class=\"btn-gray\"\n                @click=\"ownersCommitteeClose\"><span>取消</span></button>\n      </div>\n    </Drawer>\n  </div>\n</template>\n\n<script>\nimport { ownersCommitteeInsert, ownersCommitteeUpdate, ownersCommitteeFindById } from '@/api/butler'\nimport { userResident, userResidentFindResidentNameBySearch } from '@/api/basic'\nexport default {\n  data () {\n    return {\n      options: [],\n      loading: false,\n      // 业委会标题 业委会显示隐藏\n      ownersCommitteeTitle: '',\n      ownersCommittee_vrisible: false,\n      editBool: false,\n      editId: 0,\n      // 选中表格数据\n      table_row: [],\n      config: {\n        thead: [\n          { label: '序号', type: 'index', width: '80' },\n          { label: '职位', prop: 'positionId', width: 'auto' },\n          { label: '姓名', prop: 'name', width: 'auto' },\n          { label: '性别', prop: 'sexId', width: 'auto' },\n          { label: '年龄', prop: 'age', width: 'auto' },\n          { label: '学历', prop: 'educationId', width: 'auto' },\n          { label: '房屋信息', prop: 'roomName', width: 'auto' },\n          { label: '职业', prop: 'profession', width: 'auto' },\n        ],\n        table_data: [],\n        url: 'ownersCommitteeList',\n        search_item: [\n          {\n            type: 'select',\n            label: '职位',\n            placeholder: '请输入',\n            prop: 'positionId',\n            value: '',\n            options: [\n              { value: 1, label: '业委会主任' },\n              { value: 2, label: '业委会副主任' },\n              { value: 3, label: '业委会委员' },\n            ]\n          },\n          {\n            type: 'Input',\n            label: '姓名',\n            placeholder: '请输入',\n            prop: 'name',\n          },\n          {\n            type: 'select',\n            label: '学历',\n            placeholder: '请选择',\n            prop: 'educationId',\n            options: [\n              { value: 1, label: '专科' },\n              { value: 2, label: '本科' },\n              { value: 3, label: '硕士' },\n              { value: 4, label: '博士' },\n            ]\n          },\n          {\n            type: 'select',\n            label: '性别',\n            placeholder: '请选择',\n            prop: 'sexId',\n            value: '',\n            options: [\n              { value: '1', label: '男' },\n              { value: '2', label: '女' }\n            ]\n          },\n          {\n            type: 'Input',\n            label: '房屋信息',\n            placeholder: '请输入',\n            prop: 'roomName',\n\n          },\n          {\n            type: 'Input',\n            label: '职业',\n            placeholder: '请输入',\n            prop: 'profession'\n          }\n        ],\n        data: {\n          pageNum: 1,\n          size: 10\n        },\n      },\n      fileUrls: '',\n      ownersCommitteeForm: {\n        ruleForm: {\n          residentId: null,\n          positionId: null,\n          age: null,\n          educationId: null,\n          roomName: null,\n          profession: null,\n          // sex: null,\n          fileUrls: []\n        },\n        form_item: [\n          { type: 'Slot', label: '姓名', placeholder: '请输入姓名', width: '50%', prop: 'residentId', slotName: 'residentId' },\n          {\n            type: 'Select', label: '职位', placeholder: '请选择职位', width: '50%', prop: 'positionId',\n            options: [\n              { value: 1, label: '业委会主任' },\n              { value: 2, label: '业委会副主任' },\n              { value: 3, label: '业委会委员' }\n            ]\n          },\n          // { type: 'Select', label: '性别', placeholder: '请选择性别', options: [], width: '50%', prop: 'sex' },\n          {\n            type: 'Input', label: '年龄', placeholder: '请输入年龄', width: '50%', prop: 'age',\n          },\n          {\n            type: 'Select', label: '学历', placeholder: '请选择学历', width: '50%', prop: 'educationId',\n            options: [\n              { value: 1, label: '专科' },\n              { value: 2, label: '本科' },\n              { value: 3, label: '硕士' },\n              { value: 4, label: '博士' }\n            ]\n          },\n          { type: 'Input', label: '房屋信息', placeholder: '请输入房屋信息', width: '50%', prop: 'roomName', disabled: true },\n          {\n            type: 'Input', label: '职业', placeholder: '请输入职业', width: '50%', prop: 'profession'\n          },\n          { type: 'Slot', label: '图片上传', width: '100%', prop: 'fileUrls', slotName: 'fileUrls' },\n        ],\n        rules: {\n          residentId: [{ required: true, message: '请输入姓名', trigger: 'change' }],\n          positionId: [{ required: true, message: '请选择职位', trigger: 'change' }],\n          sex: [{ required: true, message: '请选择性别', trigger: 'change' }],\n          age: [{ required: true, message: '请输入工单名称', trigger: 'blur' }],\n          educationId: [{ required: true, message: '请选择学历', trigger: 'change' }],\n          roomName: [{ required: true, message: '请输入房屋信息', trigger: 'blur' }],\n          profession: [{ required: true, message: '请选择职业', trigger: 'blur' }],\n          fileUrls: [{ required: true, message: '请上传图片', trigger: 'change' }],\n        }\n      },\n      ownersObj: {}\n    }\n  },\n  methods: {\n    remoteMethod (val) {\n      let reeData = {\n        pageNum: 1,\n        size: 20,\n        name: val\n      }\n      this.loading = true\n      userResidentFindResidentNameBySearch(reeData).then(res => {\n        this.options = res.tableList\n        this.loading = false\n      })\n    },\n    focus () {\n      let reeData = {\n        pageNum: 1,\n        size: 20\n      }\n      this.loading = true\n      userResidentFindResidentNameBySearch(reeData).then(res => {\n        this.options = res.tableList\n        this.loading = false\n        console.log(res)\n      })\n    },\n    change (value, options) {\n      let arr2 = options.filter(function (item) {\n        if (item.value === value) {\n          return item;\n        }\n      });\n      this.ownersObj = arr2[0]\n      this.ownersCommitteeForm.ruleForm.roomName = this.ownersObj.roomName\n      console.log(this.ownersObj)\n    },\n    // 添加修改弹窗提交验证通过\n    ownersCommitteeRuleSubmit () {\n      let resData = {\n        residentId: this.ownersObj.value,\n        positionId: this.ownersCommitteeForm.ruleForm.positionId,\n        age: this.ownersCommitteeForm.ruleForm.age,\n        educationId: this.ownersCommitteeForm.ruleForm.educationId,\n        estateId: this.ownersObj.estateId,\n        profession: this.ownersCommitteeForm.ruleForm.profession,\n        fileUrls: this.ownersCommitteeForm.ruleForm.fileUrls,\n      }\n      if (!this.editId) {\n\n        console.log(resData)\n        ownersCommitteeInsert(resData).then(res => {\n          if (res.status) {\n            this.$message({\n              message: res.message,\n              type: 'success'\n            })\n            this.ownersCommitteeClose()\n            this.$refs.table.loadData()\n          }\n        })\n      } else {\n        resData.id = this.editId\n        ownersCommitteeUpdate(resData).then(res => {\n          if (res.status) {\n            this.$message({\n              message: res.message,\n              type: 'success'\n            })\n            this.$refs.table.loadData()\n            this.ownersCommitteeClose()\n          }\n        })\n      }\n    },\n    // 添加修改弹窗提交\n    ownersCommitteeSubmit () {\n      this.$refs.ownersCommitteeVueForm.submitForm()\n    },\n    // 添加成员 弹窗显示\n    addOwnersCommittee () {\n      this.ownersCommitteeTitle = ' 添加成员'\n      this.ownersCommittee_vrisible = true;\n    },\n\n    // 修改 弹窗显示\n    edit (data) {\n      if (data.length) {\n        if (data.length > 1) {\n          this.$message.error('不能批量编辑');\n          return\n        }\n        this.ownersCommitteeTitle = ' 修改成员'\n        this.ownersCommittee_vrisible = true;\n        let resData = {\n          id: data[0].id\n        }\n        this.ownersCommitteeForm.ruleForm.residentId = data[0].name\n        this.ownersCommitteeForm.ruleForm.roomName = data[0].roomName\n        this.ownersCommitteeForm.ruleForm.positionId = data[0].positionId\n        this.ownersCommitteeForm.ruleForm.age = data[0].age\n        this.ownersCommitteeForm.ruleForm.educationId = data[0].educationId\n        this.ownersCommitteeForm.ruleForm.profession = data[0].profession\n        this.ownersObj.value = data[0].estateId\n        this.ownersObj.estateId = data[0].estateId\n        ownersCommitteeFindById(resData).then(result => {\n          console.log(result)\n          this.editBool = true;\n          this.editId = result.id\n          this.ownersCommitteeForm.ruleForm.fileUrls[0] = result.imgUrls[0].url\n          this.fileUrls = result.imgUrls[0].url\n        })\n      } else {\n        this.$message.error('请选择需要编辑的数据');\n      }\n    },\n    tableCheck (data) {\n      this.table_row = data;\n    },\n    //  弹窗关闭显示\n    ownersCommitteeClose () {\n      // 初始化数据 重置\n      this.editId = 0\n      this.fileUrls = ''\n      this.ownersObj = {}\n      for (let key in this.ownersCommitteeForm.ruleForm) {\n        this.$set(this.ownersCommitteeForm.ruleForm, key, null)\n      }\n      console.log(this.ownersCommitteeForm.ruleForm)\n      this.$refs.ownersCommitteeVueForm.reset()\n      this.ownersCommittee_vrisible = false\n    },\n    // 删除\n    del (data) {\n      let arr = []\n      for (let i = 0; i < this.table_row.length; i++) {\n        arr.push(this.table_row[i].id)\n      }\n      if (!arr.length) {\n        this.$message.error('请选中需要删除的表格数据')\n        return\n      }\n      this.$confirm('是否删除？删除不可找回', '删除', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      }).then(() => {\n        this.$refs.table.tableDelete(arr)\n      }).catch(action => { });\n    },\n    // 图片上传成功\n    ownersImgeSuccess (res, file) {\n      this.fileUrls = res.url\n      this.ownersCommitteeForm.ruleForm.fileUrls[0] = res.url\n      this.editBool = false\n    },\n    // 图片上传之前\n    beforeAvatarUpload (file) {\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      const isJPG = file.type === 'image/png'\n      const isPNG = file.type === 'image/jpeg'\n      if (!isJPG && !isPNG) {\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return (isJPG || isPNG) && isLt2M;\n    },\n  }\n}\n</script>\n<style>\n.sys-image {\n    width: 80px;\n    height: 80px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n    background: rgba(0, 0, 0, 0.04);\n    border-radius: 2px;\n    box-sizing: border-box;\n    border: 1px solid rgba(0, 0, 0, 0.15);\n    margin-right: 12px;\n}\n</style>\n"]}