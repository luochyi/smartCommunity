{"version":3,"sources":["webpack:///src/views/operation/page/src/views/operation/page/eventManagement.vue"],"names":[],"mappings":"AA0iBA,kCACA,cAAA,CACA,yCAAA,CACA,eAAA,CACA,UAAA,CACA,iBACA,CACA,0BACA,YACA,CACA,8BACA,mBACA,CACA,2BACA,UAAA,CACA,YAAA,CACA,cAAA,CACA,6BACA,CACA,uCACA,kBACA,CACA,2BACA,MACA,CACA,4BACA,YAAA,CACA,cAAA,CACA,kBAAA,CACA,6BACA,CACA,qCACA,UAAA,CACA,cAAA,CACA,kBACA,CACA,gCACA,eAAA,CACA,wBACA","file":"chunk-2052da92.52523683.css","sourcesContent":["<template>\n  <div class=\"main-content\">\n    <div class=\"main-titel\">\n      <span>活动管理</span>\n    </div>\n    <div class=\"content\">\n      <div class=\"content-btn\">\n        <el-button class=\"init-button\"\n                   @click=\"add()\"\n                   icon=\"el-icon-plus\">新增活动</el-button>\n      </div>\n      <div class=\"\">\n        <VueTable ref=\"table\"\n                  :config='config'\n                  @tableCheck=\"tableCheck\">\n          <template slot=\"tabs\">\n            <el-tabs v-model=\"activeName\"\n                     @tab-click=\"handleClick\">\n              <el-tab-pane label=\"全部\"\n                           name=\"0\"></el-tab-pane>\n              <el-tab-pane label=\"未开始\"\n                           name=\"1\"></el-tab-pane>\n              <el-tab-pane label=\"进行中\"\n                           name=\"2\"></el-tab-pane>\n              <el-tab-pane label=\"已结束\"\n                           name=\"3\"></el-tab-pane>\n            </el-tabs>\n          </template>\n          <template slot=\"footer\">\n            <div class=\"table-footer\">\n              <button @click='edit(table_row)'>修改</button>\n              <button @click='del(table_row)'>删除</button>\n              <button @click=\"registratinRecord(table_row)\">报名记录</button>\n            </div>\n          </template>\n        </VueTable>\n        <!-- 新增修改 -->\n        <Drawer :drawerTitle=\"addEidtTitle\"\n                @drawerClose=\"addEidtClose\"\n                :drawerVrisible='addEidt_vrisible'>\n          <div style=\"padding:30px\">\n            <FromCard>\n              <template slot=\"title\">基本信息</template>\n              <template>\n                <VueForm ref=\"addEidtVueForm\"\n                         :formObj='addEidtForm'>\n                  <template slot='fileUrls'>\n                    <template>\n                      <el-upload :action=\"`${$baseUrl}upload/uploadActivity`\"\n                                 :on-success=\"ImgeSuccess\"\n                                 :file-list=\"imglist\"\n                                 :on-exceed=\"handleExceed\"\n                                 :limit=\"1\"\n                                 accept=\".jpg,.png,.JPG,.PNG\"\n                                 :before-upload=\"beforeAvatarUpload\">\n                        <el-button icon=\"el-icon-edit\"\n                                   size=\"small\">上传图片</el-button>\n                        <span style='margin-left:10px;font-size:12px;color:#444444'>建议比例：3:2</span>\n                        <div slot=\"tip\"\n                             class=\"el-upload__tip\">\n                          <span>支持扩展名：png,jpg</span>\n                        </div>\n                      </el-upload>\n                    </template>\n                  </template>\n\n                </VueForm>\n              </template>\n            </FromCard>\n          </div>\n          <div slot=\"footer\">\n            <button class=\"btn-orange\"\n                    @click=\"addEidtSubmit()\"><span> <i class=\"el-icon-circle-check\"></i>提交</span></button>\n            <button class=\"btn-gray\"\n                    @click=\"addEidtClose\"><span>取消</span></button>\n          </div>\n        </Drawer>\n        <!-- record 报名记录-->\n        <Drawer drawerTitle=\"报名记录\"\n                @drawerClose=\"recordClose\"\n                :drawerVrisible='record_vrisible'>\n          <div style=\"padding:30px\">\n            <FromCard>\n              <template slot=\"title\">基本信息</template>\n              <div class=\"flex\"\n                   style=\"padding:10px 0\">\n                <div style=\"width:60px;\">活动标题</div>\n                <div style=\"flex:1;padding-left:10px\">{{table_row.length?table_row[0].title:''}}</div>\n              </div>\n              <!-- <div class=\"flex\"\n                   style=\"padding:10px 0\">\n                <div style=\"width:60px;\">活动类型</div>\n                <div style=\"flex:1;padding-left:10px\">社区问</div>\n              </div> -->\n              <div class=\"flex\"\n                   style=\"padding:10px 0\">\n                <div style=\"width:60px;\">文化传播</div>\n                <div style=\"flex:1;padding-left:10px\">\n                  <tableData :config=\"recordTableData\">\n                  </tableData>\n                </div>\n              </div>\n            </FromCard>\n          </div>\n          <div slot=\"footer\">\n            <button class=\"btn-orange\"\n                    @click=\"recordClose()\"><span> <i class=\"el-icon-circle-check\"></i>确定</span></button>\n\n          </div>\n        </Drawer>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport { activityManagementUpdate, activityManagementFindById, sponsorManagementList, activityManagementInsert, activityManagementFindRegistrationById } from '@/api/operation'\nimport { dailyPaymentFindEnableTempleDetail } from '@/api/charge'\n\n\nexport default {\n  data () {\n    return {\n      table_row: [],\n      imglist: [],\n      record_vrisible: false,\n      config: {\n        thead: [\n          { label: '序号', type: 'index', width: '80' },\n          { label: '通知标题', prop: 'title', width: '180' },\n          { label: '主办方', prop: 'sponsorUnit', width: '100' },\n          { label: '图片', prop: 'imgs', width: 'auto' },\n          { label: '活动地点', prop: 'location', width: '140' },\n          { label: '活动联系人', prop: 'name', width: '140' },\n          { label: '联系电话', prop: 'tel', width: '140' },\n          { label: '报名开始时间', prop: 'registrationStartTime', width: '180' },\n          { label: '报名截止时间', prop: 'registrationEndTime', width: '180' },\n          { label: '活动开始时间', prop: 'activityStartTime', width: '180' },\n          { label: '活动结束时间', prop: 'activityEndTime', width: '180' },\n          { label: '状态', prop: 'status', width: 'auto' },\n          { label: '报名人数', prop: 'registrationNumber', width: ' 180' },\n          { label: '收费标准', prop: 'participantsNumber', width: '120' },\n          { label: '退费', prop: 'refund', width: '120' },\n          { label: '创建人', prop: 'createName', width: '100' },\n          { label: '更新时间', prop: 'updateDate', width: '180' },\n        ],\n        table_data: [],\n        url: 'activityManagementList',\n        search_item: [\n          {\n            type: 'Input',\n            label: '通知标题',\n            placeholder: '请输入内容',\n            prop: 'title'\n          },\n          {\n            type: 'startDate',\n            label: '活动开始时间',\n            placeholder: '请选择开始日期',\n            prop: 'activityStartTimeStart',\n          },\n          {\n            type: 'endDate',\n            label: '活动结束时间',\n            placeholder: '请选择结束时间',\n            prop: 'activityStartTimeEnd',\n          },\n        ],\n        data: {\n          pageNum: 1,\n          size: 10\n        },\n      },\n      addEidtTitle: '新增公告',\n      addEidt_vrisible: false,\n      addEidtForm: {\n        ruleForm: {\n          sponsorId: null,\n          title: null,\n          content: null,\n          fileUrls: [],\n          location: null,\n          registrationStartTime: null,\n          registrationEndTime: null,\n          activityStartTime: null,\n          activityEndTime: null,\n          participantsNumber: null,\n          chargesTemplateDetailId: null,\n          status: null,\n          refund: null,\n          name: null,\n          tel: null\n        },\n        form_item: [\n          {\n            type: 'Select',\n            label: '主办方',\n            width: '50%',\n            placeholder: '请选择',\n            prop: 'sponsorId',\n            options: []\n          },\n          {\n            type: 'Input',\n            label: '活动标题',\n            placeholder: '请输入',\n            prop: 'title',\n            width: '100%'\n          },\n          {\n            type: 'textarea',\n            label: '活动内容 ',\n            placeholder: '请输入',\n            width: '100%',\n            rows: 5,\n            prop: 'content'\n          },\n          // fileUrls\n          {\n            type: 'Slot',\n            label: '图片',\n            placeholder: '请输入',\n            width: '100%',\n            rows: 5,\n            prop: 'fileUrls',\n            slotName: 'fileUrls'\n          },\n          {\n            type: 'Input',\n            label: '活动地点',\n            placeholder: '请输入',\n            prop: 'location',\n            width: '100%'\n          },\n          {\n            type: 'DateTime',\n            label: '报名开始时间',\n            placeholder: '请选择',\n            width: '50%',\n            prop: 'registrationStartTime'\n          },\n          {\n            type: 'DateTime',\n            label: '报名截止时间',\n            placeholder: '请选择',\n            width: '50%',\n            prop: 'registrationEndTime',\n          },\n          {\n            type: 'DateTime',\n            label: '活动开始时间',\n            placeholder: '请选择',\n            width: '50%',\n            prop: 'activityStartTime'\n          },\n          {\n            type: 'DateTime',\n            label: '活动截止时间',\n            placeholder: '请选择',\n            width: '50%',\n            prop: 'activityEndTime',\n          },\n          {\n            type: 'Input',\n            label: '参与人数',\n            width: '50%',\n            placeholder: '请输入',\n            prop: 'participantsNumber'\n          },\n          {\n            type: 'Select',\n            label: '收费标准',\n            width: '50%',\n            placeholder: '请选择',\n            prop: 'chargesTemplateDetailId',\n            options: [\n              {\n                value: 1,\n                label: '半年付'\n              },\n              {\n                value: 2,\n                label: '一年付'\n              }\n            ]\n          },\n          {\n            type: 'Input',\n            label: '退费',\n            width: '50%',\n            placeholder: '请输入',\n            prop: 'refund'\n          },\n          {\n            type: 'Input',\n            label: '联系人',\n            width: '50%',\n            placeholder: '请输入',\n            prop: 'name'\n          },\n          {\n            type: 'Input',\n            label: '联系电话',\n            width: '50%',\n            placeholder: '请输入',\n            prop: 'tel'\n          },\n          {\n            type: 'Select',\n            label: '状态',\n            width: '50%',\n            placeholder: '请选择租房状态',\n            prop: 'status',\n            options: [\n              {\n                value: 1,\n                label: '已租'\n              },\n              {\n                value: 2,\n                label: '已售'\n              }\n            ]\n          }\n        ]\n      },\n      activeName: '0',\n      editID: null,\n      recordTableData: {\n        thead: [\n          { label: '序号', type: 'index', width: '80' },\n          { label: '姓名', prop: 'residentName', width: 'auto' },\n          { label: '联系方式', prop: 'residentTel', width: 'auto' },\n          { label: '报名时间', prop: 'registrationDate', width: 'auto' },\n        ],\n        table_data: [\n        ],\n        checkbox: false\n      }\n    }\n  },\n  created () {\n    let resData = {\n      pageNum: 1,\n      size: 100\n    }\n    // 主办方\n    sponsorManagementList(resData).then(res => {\n      console.log(res)\n      const data = res.tableList.map(item => {\n        return {\n          value: item.id,\n          label: item.sponsorUnit\n        }\n      })\n      let sponsorIdObj = this.addEidtForm.form_item.find(item => item.prop === 'sponsorId')\n      sponsorIdObj.options = data\n    })\n    // 收费标准\n    dailyPaymentFindEnableTempleDetail().then(result => {\n      const feeData = result.data.map(item => {\n        return {\n          value: item.id,\n          label: item.name,\n          unitPrice: item.unitPrice,\n          type: item.type\n        }\n      })\n      let chargesTemplateDetailIdObj = this.addEidtForm.form_item.find(item => item.prop === 'chargesTemplateDetailId')\n      chargesTemplateDetailIdObj.options = feeData\n    })\n  },\n  methods: {\n    handleClick (tab, event) {\n      let status = null\n      if (this.activeName != 0) {\n        status = this.activeName\n      } else {\n        status = null\n      }\n      const requestData = {\n        pageNum: 1,\n        size: 10,\n        status: status\n      }\n      this.$refs.table.requestData(requestData);\n    },\n    recordClose () {\n      this.record_vrisible = false\n    },\n    // 报名记录\n    registratinRecord (data) {\n      if (data.length > 1) {\n        this.$message.error('只能查看一条数据的详情');\n        return\n      }\n      if (!data.length) {\n        this.$message.error('请选择');\n        return\n      }\n\n      activityManagementFindRegistrationById({ id: data[0].id }).then(res => {\n        console.log(res)\n        this.recordTableData.table_data = res ? res : []\n        this.record_vrisible = true\n\n      })\n    },\n    // 删除\n    del (data) {\n      if (data.length) {\n        let arr = []\n        for (let i = 0; i < this.table_row.length; i++) {\n          arr.push(this.table_row[i].id)\n        }\n        this.$confirm('是否确认删除？删除不可恢复', '删除', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          confirmButtonClass: 'confirmButton',\n          cancelButtonClass: 'cancelButton'\n        }).then(() => {\n          this.$refs.table.tableDelete(arr)\n        }).catch(action => { });\n      } else {\n        this.$message.error('请选中需要删除的数据');\n      }\n    },\n    tableCheck (data) {\n      this.table_row = data;\n    },\n    // 弹窗关闭\n    addEidtClose () {\n      this.addEidt_vrisible = false\n      this.imglist = []\n      for (let key in this.addEidtForm.ruleForm) {\n        this.addEidtForm.ruleForm[key] = null\n        this.addEidtForm.ruleForm.file = []\n      }\n    },\n    // 提交\n    addEidtSubmit () {\n      for (let key in this.addEidtForm.ruleForm) {\n        if (!this.addEidtForm.ruleForm[key]) {\n          let data = this.addEidtForm.form_item.find(item => key === item.prop)\n          this.$message.error(`请填写${data.label}`)\n          return\n        }\n      }\n      if (!this.addEidtForm.ruleForm.fileUrls.length) {\n        this.$message.error(`请上传图片`)\n        return\n      }\n      console.log(this.addEidtForm.ruleForm)\n      if (!this.editID) {\n        activityManagementInsert(this.addEidtForm.ruleForm).then((res) => {\n          if (res.status) {\n            this.$message({\n              message: res.message,\n              type: 'success'\n            })\n            this.addEidtClose()\n            this.$refs.table.loadData()\n          }\n        })\n      } else {\n        let resData = {\n          id: this.editID,\n          ...this.addEidtForm.ruleForm\n        }\n        activityManagementUpdate(resData).then((res) => {\n          if (res.status) {\n            this.$message({\n              message: res.message,\n              type: 'success'\n            })\n            this.addEidtClose()\n            this.$refs.table.loadData()\n          }\n        })\n      }\n\n    },\n    // 修改\n    edit (data) {\n      if (data.length > 1) {\n        this.$message.error('只能查看一条数据的详情');\n        return\n      }\n      if (!data.length) {\n        this.$message.error('请选择');\n        return\n      }\n      activityManagementFindById({ id: this.table_row[0].id }).then(res => {\n        console.log(res)\n        this.editID = res.id\n\n        if (res.imgUrls.length) {\n          let obj = {\n            name: res.imgUrls[0].url,\n            url: res.imgUrls[0].url,\n          }\n          this.addEidtForm.ruleForm.fileUrls = [res.imgUrls[0].url]\n          this.$set(this.imglist, 0, obj)\n        } else {\n          this.addEidtForm.ruleForm.fileUrls = []\n        }\n        this.addEidtForm.ruleForm.sponsorId = res.sponsorId\n        this.addEidtForm.ruleForm.title = res.title\n        this.addEidtForm.ruleForm.content = res.content\n        this.addEidtForm.ruleForm.location = res.location\n        this.addEidtForm.ruleForm.registrationStartTime = res.registrationStartTime\n        this.addEidtForm.ruleForm.registrationEndTime = res.registrationEndTime\n        this.addEidtForm.ruleForm.activityStartTime = res.activityStartTime\n        this.addEidtForm.ruleForm.activityEndTime = res.activityEndTime\n        this.addEidtForm.ruleForm.participantsNumber = res.participantsNumber\n        this.addEidtForm.ruleForm.chargesTemplateDetailId = res.chargesTemplateDetailId\n        this.addEidtForm.ruleForm.status = res.status\n        this.addEidtForm.ruleForm.refund = res.refund\n        this.addEidtForm.ruleForm.name = res.name\n        this.addEidtForm.ruleForm.tel = res.tel\n        this.addEidt_vrisible = true\n      })\n    },\n    // 添加\n    add () {\n      this.addEidt_vrisible = true\n    },\n    // 图片上传成功\n    ImgeSuccess (res, file) {\n      console.log(res)\n      this.$set(this.addEidtForm.ruleForm.fileUrls, 0, res.url)\n    },\n    // 图片文件上传之前\n    beforeAvatarUpload (file) {\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      const isJPG = file.type === 'image/png'\n      const isPNG = file.type === 'image/jpeg'\n      if (!isJPG && !isPNG) {\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return (isJPG || isPNG) && isLt2M;\n    },\n\n    // 上传限制提示\n    handleExceed (files, fileList) {\n      this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\n    },\n\n  }\n}\n</script>\n<style scoped>\n.main-titel span {\n    font-size: 16px;\n    font-family: PingFangSC-Medium, PingFang SC;\n    font-weight: 500;\n    color: #333333;\n    padding-left: 21px;\n}\n.content {\n    padding: 20px;\n}\n.content-btn {\n    padding-bottom: 20px;\n}\n.form-box {\n    width: 100%;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n}\n.form-box > .form-input {\n    margin-right: 170px;\n}\n.form-btn {\n    flex: 1;\n}\n.input-box {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: space-between;\n}\n.input-box > div > span {\n    color: #999999;\n    font-size: 14px;\n    padding-right: 10px;\n}\n.content-table {\n    margin-top: 20px;\n    border: 1px solid #f5f5f6;\n}\n</style>\n"]}