{"version":3,"sources":["webpack:///src/views/operation/page/src/views/operation/page/notificationManagement.vue"],"names":[],"mappings":"AAmYA,kCACA,cAAA,CACA,yCAAA,CACA,eAAA,CACA,UAAA,CACA,iBACA,CACA,0BACA,YACA,CACA,8BACA,mBACA,CACA,2BACA,UAAA,CACA,YAAA,CACA,cAAA,CACA,6BACA,CACA,uCACA,kBACA,CACA,2BACA,MACA,CACA,4BACA,YAAA,CACA,cAAA,CACA,kBAAA,CACA,6BACA,CACA,qCACA,UAAA,CACA,cAAA,CACA,kBACA,CACA,gCACA,eAAA,CACA,wBACA","file":"chunk-1e316972.e9b87b12.css","sourcesContent":["<template>\n  <div class=\"main-content\">\n    <div class=\"main-titel\">\n      <span>通知管理</span>\n    </div>\n    <div class=\"content\">\n      <div class=\"content-btn\">\n        <el-button class=\"init-button\"\n                   icon=\"el-icon-plus\"\n                   @click=\"add()\">新增公告</el-button>\n      </div>\n      <div class=\"\">\n        <VueTable ref=\"table\"\n                  :config='config'\n                  @tableCheck=\"tableCheck\">\n          <template slot=\"footer\">\n            <div class=\"table-footer\">\n\n              <button @click='edit(table_row)'>修改</button>\n              <button @click='del(table_row)'>删除</button>\n            </div>\n          </template>\n        </VueTable>\n\n      </div>\n      <!-- 增加修改 -->\n      <Drawer :drawerTitle=\"addEidtTitle\"\n              @drawerClose=\"addEidtClose\"\n              :drawerVrisible='addEidt_vrisible'>\n        <div style=\"padding:30px\">\n          <FromCard>\n            <template slot=\"title\">基本信息</template>\n            <template>\n              <VueForm ref=\"addEidtForm\"\n                       :formObj='addEidtForm'>\n                <template slot='pushObject'>\n\n                  <el-radio :label=\"-1\"\n                            v-model=\"addEidtForm.ruleForm.pushObject\">全体业主</el-radio>\n\n                  <div style=\"margin: 6px 0 \">\n                    <el-radio :label=\"-2\"\n                              v-model=\"addEidtForm.ruleForm.pushObject\">全体租户</el-radio>\n                  </div>\n                  <div style=\"margin: 6px 0 \">\n                    <el-radio :label=\"1\"\n                              v-model=\"addEidtForm.ruleForm.pushObject\">自定义楼栋</el-radio>\n                  </div>\n                  <div>\n                    <el-select v-model=\"BuildID\"\n                               :disabled='BuildDisabled'\n                               style=\"width:240px\"\n                               placeholder=\"请选择楼栋\">\n                      <el-option v-for=\"item in options\"\n                                 :key=\"item.value\"\n                                 :label=\"item.label\"\n                                 :value=\"item.value\">\n                      </el-option>\n                    </el-select>\n                  </div>\n                </template>\n                <template slot='pushStatus'>\n                  <el-radio :label=\"1\"\n                            v-model=\"addEidtForm.ruleForm.pushStatus\">实时推送</el-radio>\n                  <div style=\"margin:6px 0 \">\n                    <el-radio :label=\"2\"\n                              v-model=\"addEidtForm.ruleForm.pushStatus\">定时推送</el-radio>\n                  </div>\n                  <div>\n                    <el-date-picker v-model=\"addEidtForm.ruleForm.timingPush\"\n                                    :disabled='timeDisabled'\n                                    value-format=\"yyyy-MM-dd HH:mm:ss\"\n                                    type=\"datetime\"\n                                    placeholder=\"选择日期时间\"\n                                    align=\"right\">\n                    </el-date-picker>\n                  </div>\n                </template>\n              </VueForm>\n\n            </template>\n          </FromCard>\n        </div>\n        <div slot=\"footer\">\n          <button class=\"btn-orange\"\n                  @click=\"addEidtSubmit()\"><span> <i class=\"el-icon-circle-check\"></i>提交</span></button>\n          <button class=\"btn-gray\"\n                  @click=\"addEidtClose\"><span>取消</span></button>\n        </div>\n      </Drawer>\n    </div>\n  </div>\n</template>\n<script>\nimport { cpmBuildingUnitFindAll } from '@/api/basic'\nimport { notificationManagementInsert, notificationManagementFindById, notificationManagementUpdate } from '@/api/operation'\n\n// notificationManagementInsert\n\nexport default {\n\n  data () {\n    return {\n      addEidtTitle: '',\n      addEidt_vrisible: false,\n      timeDisabled: true,\n      BuildDisabled: true,\n      BuildID: null,\n      options: null,\n      editId: null,\n      addEidtForm: {\n        ruleForm: {\n          title: null,\n          content: null,\n          suffix: null,\n          pushObject: null,\n          timingPush: null,\n          pushStatus: null,\n        },\n        form_item: [\n          {\n            type: 'Input',\n            label: '通知标题',\n            placeholder: '请输入',\n            width: '100%',\n            prop: 'title',\n          },\n          {\n            type: 'textarea',\n            label: '通知内容',\n            placeholder: '请输入',\n            width: '100%',\n            rows: 5,\n            prop: 'content'\n          },\n          {\n            type: 'Input',\n            label: '通知后缀',\n            placeholder: '请输入',\n            width: '100%',\n            prop: 'suffix',\n          },\n          // 1.元/月 平方米，2.元/ 立方米，3.元/ 次\n          //  \n          {\n            type: 'Slot',\n            label: '推送对象',\n            placeholder: '请输入',\n            width: '100%',\n            prop: 'pushObject',\n            slotName: 'pushObject'\n          },\n          {\n            type: 'Slot',\n            label: '推送时间',\n            placeholder: '请输入',\n            width: '100%',\n            prop: 'pushStatus',\n            slotName: 'pushStatus'\n          },\n        ],\n        rules: {\n          typeName: [{ required: true }],\n          marker: [{ required: true, message: '请输入费用项目名称', trigger: 'blur' }],\n\n        }\n      },\n      table_row: [],\n      config: {\n        thead: [\n          { label: '序号', type: 'index', width: '80' },\n          { label: '通知标题', prop: 'title', width: 'auto' },\n          // { label: '有效开始时间', prop: 'table3', width: 'auto' },\n          // { label: '有效结束时间', prop: 'table4', width: 'auto' },\n          { label: 'app阅读量', prop: 'readingVolume', width: 'auto' },\n          { label: '推送状态', prop: 'pushStatus', width: 'auto' },\n          { label: '短信状态', prop: '1', width: 'auto' },\n          { label: '创建人', prop: 'createName', width: 'auto' },\n          { label: '更新时间', prop: 'updateDate', width: 'auto' },\n        ],\n        table_data: [],\n        url: 'notificationManagementList',\n        search_item: [\n          {\n            type: 'Input',\n            label: '通知标题',\n            placeholder: '请输入内容',\n            prop: 'title'\n          },\n          {\n            type: 'select',\n            label: '推送状态',\n            value: '',\n            options: [\n              { label: '已推送', value: '1' },\n              { label: '未推送', value: '2' },\n            ],\n            placeholder: '请选择推送状态',\n            prop: 'pushStatus'\n          }\n        ],\n        data: {\n          pageNum: 1,\n          size: 10\n        }\n      },\n    }\n  },\n  created () {\n    cpmBuildingUnitFindAll().then(res => {\n      this.options = res\n    })\n  },\n\n  computed: {},\n  methods: {\n    add () {\n      this.addEidt_vrisible = true;\n    },\n    edit (data) {\n      if (data.length > 1) {\n        this.$message.error('只能查看一条数据的详情');\n        return\n      }\n      if (!data.length) {\n        this.$message.error('请选择');\n        return\n      }\n      notificationManagementFindById({ id: this.table_row[0].id }).then(res => {\n        console.log(res)\n        this.editId = res.id\n        this.addEidtForm.ruleForm.title = res.title\n        this.addEidtForm.ruleForm.content = res.content\n        this.addEidtForm.ruleForm.suffix = res.suffix\n\n        this.addEidtForm.ruleForm.timingPush = res.timingPush\n        this.addEidtForm.ruleForm.pushStatus = res.pushStatus\n        if (res.pushObject !== -1 && res.pushObject !== -2) {\n          // resData.pushObject = this.addEidtForm.ruleForm.pushObject\n          this.BuildID = res.pushObject\n          this.addEidtForm.ruleForm.pushObject = 1\n        } else {\n          this.addEidtForm.ruleForm.pushObject = res.pushObject\n        }\n        this.addEidt_vrisible = true;\n\n      })\n    },\n\n    addEidtSubmit () {\n      let resData = {\n        title: this.addEidtForm.ruleForm.title,\n        content: this.addEidtForm.ruleForm.content,\n        suffix: this.addEidtForm.ruleForm.suffix,\n        pushObject: this.BuildID,\n        timingPush: this.addEidtForm.ruleForm.timingPush,\n        pushStatus: this.addEidtForm.ruleForm.pushStatus\n      }\n      for (let key in resData) {\n        if (key == 'pushObject') {\n          if (this.addEidtForm.ruleForm.pushObject === 1 && !this.BuildID) {\n            this.$message.error(`选择楼栋`)\n            console.log(resData)\n            return\n          } else if (this.addEidtForm.ruleForm.pushObject !== 1) {\n            resData.pushObject = this.addEidtForm.ruleForm.pushObject\n            console.log(resData)\n          }\n        } else {\n          if (!resData[key]) {\n            let data = this.addEidtForm.form_item.find(item => key === item.prop)\n            this.$message.error(`请填写${data.label}`)\n            console.log(resData)\n            return\n          }\n        }\n\n\n      }\n\n      // 新增\n      if (!this.editId) {\n        notificationManagementInsert(resData).then(res => {\n          console.log(res)\n          // message: \"添加通知管理信息成功\", status: true\n          if (res.status) {\n            this.$message({\n              message: res.message,\n              type: 'success'\n            })\n            this.addEidtClose()\n            this.$refs.table.loadData()\n          }\n        })\n\n      } else {\n        resData.id = this.editId\n        // 编辑\n        notificationManagementUpdate(resData).then(res => {\n          console.log(resData)\n          // message: \"添加通知管理信息成功\", status: true\n          if (res.status) {\n            this.$message({\n              message: res.message,\n              type: 'success'\n            })\n            this.addEidtClose()\n            this.$refs.table.loadData()\n          }\n        })\n      }\n\n    },\n    addEidtClose () {\n      this.addEidt_vrisible = false;\n      this.editId = null;\n      this.BuildID = null\n      for (let key in this.addEidtForm.ruleForm) {\n        this.addEidtForm.ruleForm[key] = null\n      }\n    },\n    tableCheck (data) {\n      this.table_row = data;\n    },\n\n\n    // 删除\n    del (data) {\n      if (data.length) {\n        let arr = []\n        for (let i = 0; i < this.table_row.length; i++) {\n          arr.push(this.table_row[i].id)\n        }\n        this.$confirm('是否确认删除？删除不可恢复', '删除', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          confirmButtonClass: 'confirmButton',\n          cancelButtonClass: 'cancelButton'\n        }).then(() => {\n          this.$refs.table.tableDelete(arr)\n        }).catch(action => { });\n      } else {\n        this.$message.error('请选中需要删除的数据');\n      }\n    },\n  },\n  watch: {\n    'addEidtForm.ruleForm.pushStatus': {\n      handler (newValue) {\n        if (newValue === 2) {\n          this.timeDisabled = false\n        } else {\n          this.timeDisabled = true\n          // 当前日期格式化\n          let date = new Date()\n          let seperator1 = \"-\";\n          let seperator2 = \":\";\n          let month = date.getMonth() + 1;\n          let strDate = date.getDate();\n          if (month >= 1 && month <= 9) {\n            month = \"0\" + month;\n          }\n          if (strDate >= 0 && strDate <= 9) {\n            strDate = \"0\" + strDate;\n          }\n          let currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate\n            + \" \" + date.getHours() + seperator2 + date.getMinutes()\n            + seperator2 + date.getSeconds();\n          this.addEidtForm.ruleForm.timingPush = currentdate\n        }\n      },\n      immediate: true\n    },\n    'addEidtForm.ruleForm.pushObject': {\n      handler (newValue) {\n        if (newValue === 1) {\n          this.BuildDisabled = false\n        } else {\n          this.BuildDisabled = true\n        }\n      },\n      immediate: true\n    }\n  }\n}\n</script>\n<style scoped>\n.main-titel span {\n    font-size: 16px;\n    font-family: PingFangSC-Medium, PingFang SC;\n    font-weight: 500;\n    color: #333333;\n    padding-left: 21px;\n}\n.content {\n    padding: 20px;\n}\n.content-btn {\n    padding-bottom: 20px;\n}\n.form-box {\n    width: 100%;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n}\n.form-box > .form-input {\n    margin-right: 170px;\n}\n.form-btn {\n    flex: 1;\n}\n.input-box {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: space-between;\n}\n.input-box > div > span {\n    color: #999999;\n    font-size: 14px;\n    padding-right: 10px;\n}\n.content-table {\n    margin-top: 20px;\n    border: 1px solid #f5f5f6;\n}\n</style>\n"]}